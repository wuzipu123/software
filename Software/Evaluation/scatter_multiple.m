function scatter_multiple(Variables_cell,sensor_data,figure_name)

%'scatter_multiple' gives a figure with scatterplots, where the measured
%data is scattered against the reference data with an additional function
%plotted in each subplot. The coefficients for the function are taken from
%the cell generated by the function 'multiple_regression'.

%Structure of the cell generated by 'multiple_regression':
%Variables_cell{calibration method}{data for each method}

%Calibration method:
%not calibrated, lin reg wo offset, poly1, poly2, poly3, exp, power, reg_tree, 
%      1               2              3      4     5      6     7       8

%Data for each method:
%{{model_coefficients, predicted_data, observed_data, Name, Function}}
%{{        1          ,        2      ,        3     ,  4  ,   5    }}


%Input: (Variables_cell,sensor_data,figure_name)
%Variables_cell: Cell generated by function 'multiple_regression'.
%sensor_data: data from sensor that is used for function
%'multiple_regression'; sensor_PM_10 or sensor_PM_2_5 in main function.
%figure_name: How the figure shall be named. 

%Output: Figure with 8 scatterplots. 
%x-axis: reference data
%y-axis: sensor data (not calibrated) 
%additional function plotted depending on calibration method

reference_max=max(Variables_cell{1}{3});
reference_min=min(Variables_cell{1}{3});
function_plot_vector=linspace(reference_max,reference_min,20)';

functions=cell(1,length(Variables_cell)); 
functions{1}=Variables_cell{1}{1}*function_plot_vector;
functions{2}=function_plot_vector/Variables_cell{2}{1}(1,1);
functions{3}=polyval(Variables_cell{3}{1},function_plot_vector);
functions{4}=polyval(Variables_cell{4}{1},function_plot_vector);
functions{5}=polyval(Variables_cell{5}{1},function_plot_vector);
functions{6}=Variables_cell{6}{1}(1,1)*exp(Variables_cell{6}{1}(1,2)*function_plot_vector);
functions{7}=Variables_cell{7}{1}(1,1)*function_plot_vector.^Variables_cell{7}{1}(1,2);
functions{8}=predict(Variables_cell{8}{1},function_plot_vector);


figure('Name',figure_name)
for i=1:length(Variables_cell)
    subplot(4,2,i)
    scatter(Variables_cell{i}{3},sensor_data)
    hold on
    %scatter(Variables_cell{i}{3},functions{i},'.')
    plot(function_plot_vector,functions{i})
    title(Variables_cell{i}{4})
    xlabel('Reference µg/m3')
    ylabel('Sensor µg/m3')
    legend('Sensor','function plot')
end
